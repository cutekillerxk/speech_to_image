# 项目说明

## 📋 项目概述

这是一个基于Python + Gradio的图片生成demo，专为小朋友设计，界面简洁，操作简单。

## 🎯 核心功能

### ✅ 已实现功能

1. **文字生成图片**
   - 输入文字描述，调用豆包API生成图片
   - 支持模拟模式（未配置API时使用占位图片）

2. **历史记录管理**
   - 自动保存每次生成的图片
   - 图片保存在 `history/` 目录
   - 最多保存50条记录

3. **历史切换**
   - 上一张/下一张按钮
   - 显示当前图片序号和描述

4. **图片下载**
   - 支持下载当前显示的图片

### 🔄 待实现功能（音频设备到位后）

1. **音频输入**
   - 麦克风录音功能
   - 实时音频波形显示

2. **语音转文字**
   - 调用豆包语音识别API
   - 将音频转换为文字描述

## 🏗️ 架构设计

### 功能解耦

项目采用模块化设计，功能解耦：

```
┌─────────────┐
│  音频输入   │  ← 待实现（等设备到位）
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 语音转文字  │  ← 待实现（等设备到位）
└──────┬──────┘
       │
       ▼
┌─────────────┐      ┌─────────────┐
│  文字输入   │ ────▶│ 文字转图片  │  ← 已实现
└─────────────┘      └──────┬──────┘
                            │
                            ▼
                    ┌─────────────┐
                    │  图片展示   │  ← 已实现
                    └──────┬──────┘
                            │
                            ▼
                    ┌─────────────┐
                    │ 历史记录管理 │  ← 已实现
                    └─────────────┘
```

### 文件结构

```
python/
├── app.py              # Gradio主应用（界面和交互）
├── doubao_service.py   # 豆包API服务（文字转图片）
├── history_manager.py  # 历史记录管理
├── config.py          # 配置管理
├── requirements.txt    # Python依赖
├── environment.yml    # Conda环境配置
├── .env.example      # 环境变量示例
├── 启动.bat          # Windows一键启动脚本
├── README.md         # 详细文档
├── 快速开始.md        # 快速启动指南
├── 使用说明.md        # 使用说明（小朋友版）
└── history/          # 历史记录目录（自动创建）
    ├── history.json  # 历史记录索引
    └── *.png        # 保存的图片文件
```

## 🔧 技术栈

- **Python 3.8+**: 主要编程语言
- **Gradio 4.0+**: Web界面框架（简洁易用）
- **Pillow**: 图片处理
- **Requests**: HTTP请求（调用豆包API）
- **python-dotenv**: 环境变量管理

## 📝 设计原则

1. **简洁性**: 界面简洁，操作简单，适合小朋友
2. **无确认操作**: 不需要额外的确认步骤，直接操作
3. **解耦设计**: 音频→文字 和 文字→图片 功能独立，便于后续扩展
4. **容错性**: API调用失败时使用模拟模式，保证界面可用

## 🚀 后续扩展

### 音频功能扩展（等设备到位）

1. 在 `doubao_service.py` 中添加 `audio_to_text()` 方法
2. 在 `app.py` 中添加音频输入组件：
   ```python
   audio_input = gr.Audio(
       label="🎤 录音",
       type="filepath",
       sources=["microphone"]
   )
   ```
3. 连接两个功能：
   ```python
   audio_input.change(
       fn=process_audio,
       inputs=[audio_input],
       outputs=[text_input, image_output]
   )
   ```

### 其他扩展

- 图片尺寸选择
- 图片风格选择
- 批量生成
- 图片编辑功能
- 分享功能

## 📊 数据流

```
用户输入文字
    ↓
generate_image()
    ↓
doubao_service.text_to_image()
    ↓
调用豆包API / 模拟模式
    ↓
返回PIL图片对象
    ↓
history_manager.add_record()
    ↓
保存图片到history/目录
    ↓
更新全局状态
    ↓
Gradio界面显示图片
```

## 🔐 安全考虑

1. **API密钥**: 使用 `.env` 文件存储，不提交到代码仓库
2. **文件存储**: 历史记录保存在本地，不涉及网络传输
3. **输入验证**: 对用户输入进行基本验证

## 📈 性能优化

1. **历史记录限制**: 最多保存50条，避免占用过多空间
2. **图片格式**: 使用PNG格式保存，保证质量
3. **异步处理**: Gradio自动处理异步请求

## 🐛 已知问题

1. 如果没有配置API密钥，会显示占位图片（这是预期行为）
2. 历史记录切换时，如果图片文件被删除，会显示错误（需要添加错误处理）

## 📞 技术支持

如有问题，请查看：
- `README.md` - 详细文档
- `快速开始.md` - 启动指南
- `使用说明.md` - 使用说明

