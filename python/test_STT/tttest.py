"""
┌─────────────────────────────────────────────────────────────────┐
│  豆包 Seedream 图像生成 API 调用示例                              │
│                                                                 │
│  功能说明：演示如何使用 DMX API 调用豆包 Seedream 模型生成图像      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
"""

import os
import json
import requests

# ═══════════════════════════════════════════════════════════════════════════════
#  第一部分：DMX API 基础配置
# ═══════════════════════════════════════════════════════════════════════════════

# 【配置项 1】DMX API 密钥
# 说明：从环境变量获取 DMX API Key，如果没有则使用默认值
# 建议：生产环境请务必使用环境变量，避免密钥泄露
DMX_API_KEY = os.getenv("DMX_API_KEY") or "sk-TZMyzTFtM0WQvLx9zeR5syNje5CjqnBcNvejposx4CDLl6tC"

# 【配置项 2】DMX API 端点
url = "https://www.dmxapi.com/v1/images/generations"

# 【配置项 3】DMX API 请求头
headers = {
    "Content-Type": "application/json",
    "Authorization": f"Bearer {DMX_API_KEY}"
}

# ═══════════════════════════════════════════════════════════════════════════════
#  第二部分：DMX API 请求参数配置
# ═══════════════════════════════════════════════════════════════════════════════

data = {
    # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    # ▸ 基础配置
    # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

    "model": "doubao-seedream-4-0-250828",  # 使用的模型名称
    #doubao-seedream-4-5-251128
    #doubao-seedream-4-0-250828
    # ────────────────────────────────────────────────────────────────────────
    # 【参数】prompt - 图像生成提示词
    # ────────────────────────────────────────────────────────────────────────
    # • 建议长度：不超过 300 个汉字或 600 个英文单词
    # • 注意事项：字数过多会导致信息分散，模型可能忽略细节，造成图片缺失元素
    # ────────────────────────────────────────────────────────────────────────
    "prompt": (
        "星际穿越，黑洞，黑洞里冲出一辆快支离破碎的复古列车，抢视觉冲击力，"
        "电影大片，末日既视感，动感，对比色，oc渲染，光线追踪，动态模糊，景深，"
        "超现实主义，深蓝，画面通过细腻的丰富的色彩层次塑造主体与场景，质感真实，"
        "暗黑风背景的光影效果营造出氛围，整体兼具艺术幻想感，夸张的广角透视效果，"
        "耀光，反射，极致的光影，强引力，吞噬"
    ),

    # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    # ▸ 图像尺寸配置
    # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

    # ────────────────────────────────────────────────────────────────────────
    # 【参数】size - 图像尺寸设置（支持两种方式，不可混用）
    # ────────────────────────────────────────────────────────────────────────
    # 方式 1：指定分辨率（2K/4K），模型根据 prompt 判断具体尺寸
    # 方式 2：指定具体像素值（如 "2048x2048"）
    #
    # ┌───────────────────────────────────────────────────────────────────────┐
    # │ doubao-seedream-4.5 推荐尺寸                                          │
    # ├──────────┬────────────────┬─────────────────────────────────────────┤
    # │ 宽高比   │ 推荐尺寸       │ 说明                                    │
    # ├──────────┼────────────────┼─────────────────────────────────────────┤
    # │  1:1     │  2048 x 2048   │ 标准正方形（默认值）                    │
    # │  4:3     │  2304 x 1728   │ 传统横向照片                            │
    # │  3:4     │  1728 x 2304   │ 传统竖向照片                            │
    # │  16:9    │  2560 x 1440   │ 宽屏横向                                │
    # │  9:16    │  1440 x 2560   │ 宽屏竖向                                │
    # │  3:2     │  2496 x 1664   │ 35mm 胶片横向                           │
    # │  2:3     │  1664 x 2496   │ 35mm 胶片竖向                           │
    # │  21:9    │  3024 x 1296   │ 超宽屏                                  │
    # └──────────┴────────────────┴─────────────────────────────────────────┘
    # • 总像素范围：2560×1440=3686400 ~ 4096×4096=16777216
    # • 宽高比范围：1/16 ~ 16
    # • ⚠️ 注意：方式 2 需同时满足总像素和宽高比的取值范围
    #
    # 有效示例：3750x1250
    #   → 总像素 3750×1250=4687500，符合 [3686400, 16777216]
    #   → 宽高比 3750/1250=3，符合 [1/16, 16]
    #
    # 无效示例：1500x1500
    #   → 总像素 1500×1500=2250000，未达到 3686400 的最低要求
    #   → 虽然宽高比符合要求，但因未同时满足两项限制，故无效
    #
    # ┌───────────────────────────────────────────────────────────────────────┐
    # │ doubao-seedream-4.0 推荐尺寸                                          │
    # ├──────────┬────────────────┬─────────────────────────────────────────┤
    # │ 宽高比   │ 推荐尺寸       │ 说明                                    │
    # ├──────────┼────────────────┼─────────────────────────────────────────┤
    # │  1:1     │  2048 x 2048   │ 标准正方形（默认值）                    │
    # │  4:3     │  2304 x 1728   │ 传统横向照片                            │
    # │  3:4     │  1728 x 2304   │ 传统竖向照片                            │
    # │  16:9    │  2560 x 1440   │ 宽屏横向                                │
    # │  9:16    │  1440 x 2560   │ 宽屏竖向                                │
    # │  3:2     │  2496 x 1664   │ 35mm 胶片横向                           │
    # │  2:3     │  1664 x 2496   │ 35mm 胶片竖向                           │
    # │  21:9    │  3024 x 1296   │ 超宽屏                                  │
    # └──────────┴────────────────┴─────────────────────────────────────────┘
    # • 总像素范围：1280×720=921600 ~ 4096×4096=16777216
    # • 宽高比范围：1/16 ~ 16
    # • ⚠️ 注意：方式 2 需同时满足总像素和宽高比的取值范围
    #
    # 有效示例：1600x600
    #   → 总像素 1600×600=960000，符合 [921600, 16777216]
    #   → 宽高比 1600/600=8/3，符合 [1/16, 16]
    #
    # 无效示例：800x800
    #   → 总像素 800×800=640000，未达到 921600 的最低要求
    #   → 虽然宽高比符合要求，但因未同时满足两项限制，故无效
    #
    # ┌───────────────────────────────────────────────────────────────────────┐
    # │ doubao-seedream-3.0-t2i 推荐尺寸                                      │
    # ├──────────┬────────────────┬─────────────────────────────────────────┤
    # │ 宽高比   │ 推荐尺寸       │ 说明                                    │
    # ├──────────┼────────────────┼─────────────────────────────────────────┤
    # │  1:1     │  1024 x 1024   │ 标准正方形                              │
    # │  4:3     │  1152 x 864    │ 传统横向照片                            │
    # │  3:4     │  864 x 1152    │ 传统竖向照片                            │
    # │  16:9    │  1280 x 720    │ 宽屏横向                                │
    # │  9:16    │  720 x 1280    │ 宽屏竖向                                │
    # │  3:2     │  1248 x 832    │ 35mm 胶片横向                           │
    # │  2:3     │  832 x 1248    │ 35mm 胶片竖向                           │
    # │  21:9    │  1512 x 648    │ 超宽屏                                  │
    # └──────────┴────────────────┴─────────────────────────────────────────┘
    # • 总像素范围：512×512 ~ 2048×2048
    # ────────────────────────────────────────────────────────────────────────
    "size": "2K",

    # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    # ▸ 高级参数配置
    # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

    # ────────────────────────────────────────────────────────────────────────
    # 【参数】seed - 随机种子（可选）
    # ────────────────────────────────────────────────────────────────────────
    # • 功能：控制模型生成内容的随机性
    # • 默认值：-1（完全随机）
    # • 取值范围：-1 ~ 2147483647
    # • 支持模型：doubao-seedream-3.0-t2i、doubao-seededit-3.0-i2i
    # ────────────────────────────────────────────────────────────────────────
    # "seed": -1,

    # ────────────────────────────────────────────────────────────────────────
    # 【参数】guidance_scale - 文本权重（可选）
    # ────────────────────────────────────────────────────────────────────────
    # • 功能：控制模型输出结果与 prompt 的一致程度
    # • 说明：值越大，与提示词相关性越强，模型自由度越小
    # • 取值范围：1 ~ 10
    # • 默认值：
    #   - doubao-seedream-3.0-t2i → 2.5
    #   - doubao-seededit-3.0-i2i → 5.5
    # • ⚠️ 注意：doubao-seedream-4-5-251128、doubao-seedream-4.0 不支持此参数
    # ────────────────────────────────────────────────────────────────────────
    # "guidance_scale": 2.5,

    # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    # ▸ 组图功能配置（仅 doubao-seedream-4.5、doubao-seedream-4.0 支持）
    # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

    # ────────────────────────────────────────────────────────────────────────
    # 【参数】sequential_image_generation - 组图功能开关
    # ────────────────────────────────────────────────────────────────────────
    # • 功能：控制是否关闭组图功能
    # • 组图：基于您输入的内容，生成的一组内容关联的图片
    # • 默认值：disabled
    # • 可选值：
    #   - auto     → 自动判断模式，模型根据提示词自主判断是否返回组图及图片数量
    #   - disabled → 关闭组图功能，模型只会生成一张图
    # ────────────────────────────────────────────────────────────────────────
    # "sequential_image_generation": "disabled",

    # ────────────────────────────────────────────────────────────────────────
    # 【参数】sequential_image_generation_options - 组图功能配置（可选）
    # ────────────────────────────────────────────────────────────────────────
    # • 说明：仅当 sequential_image_generation 为 auto 时生效
    # • max_images：指定本次请求最多可生成的图片数量
    #   - 默认值：15
    #   - 取值范围：[1, 15]
    #   - ⚠️ 注意：输入的参考图数量 + 生成的图片数量 ≤ 15张
    # ────────────────────────────────────────────────────────────────────────
    # "sequential_image_generation_options": {
    #     "max_images": 15
    # },

    # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    # ▸ 输出配置
    # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

    # ────────────────────────────────────────────────────────────────────────
    # 【参数】stream - 流式输出模式（doubao-seedream-4.5、doubao-seedream-4.0 支持）
    # ────────────────────────────────────────────────────────────────────────
    # • 默认值：False
    # • False → 非流式模式，等待所有图片生成完毕后一次性返回
    # • True  → 流式模式，每张图片生成后立即返回（适用于单图和组图）
    # ────────────────────────────────────────────────────────────────────────
    "stream": False,

    # ────────────────────────────────────────────────────────────────────────
    # 【参数】response_format - 返回格式
    # ────────────────────────────────────────────────────────────────────────
    # • url      → 返回图片下载链接（⚠️ 链接有效期：24小时，请及时下载）
    # • b64_json → 返回 Base64 编码的 JSON 格式图像数据
    # ────────────────────────────────────────────────────────────────────────
    "response_format": "url",

    # ────────────────────────────────────────────────────────────────────────
    # 【参数】watermark - 水印设置
    # ────────────────────────────────────────────────────────────────────────
    # • False → 不添加水印
    # • True  → 在图片右下角添加"AI生成"字样水印标识
    #  • ⚠️ 注意：此参数已被服务器强制设置为 False，修改不会生效
    # ────────────────────────────────────────────────────────────────────────
    "watermark": False,

    # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    # ▸ 提示词优化配置（doubao-seedream-4.5、doubao-seedream-4.0 支持）
    # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

    # ────────────────────────────────────────────────────────────────────────
    # 【参数】optimize_prompt_options - 提示词优化选项（可选）
    # ────────────────────────────────────────────────────────────────────────
    # • 说明：doubao-seedream-4.5 / 4.0 默认使用标准模式优化提示词
    # • mode：优化模式
    #   - standard → 标准模式：生成内容质量更高，耗时较长
    #   - fast     → 快速模式：生成内容耗时更短，质量一般
    # • ⚠️ 注意：doubao-seedream-4.5 当前仅支持 standard 模式
    # ────────────────────────────────────────────────────────────────────────
    # "optimize_prompt_options": {
    #     "mode": "standard"
    # }
}

# ═══════════════════════════════════════════════════════════════════════════════
#  第三部分：发送请求并处理响应
# ═══════════════════════════════════════════════════════════════════════════════

# 发送 POST 请求到 API
response = requests.post(url, headers=headers, json=data)

# ───────────────────────────────────────────────────────────────────────────────
# 输出响应信息
# ───────────────────────────────────────────────────────────────────────────────

print(f"状态码: {response.status_code}")
print(f"响应内容:\n{json.dumps(response.json(), indent=2, ensure_ascii=False)}")